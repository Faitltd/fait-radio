<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FAIT Radio - Glass Interface</title>
  <link rel="stylesheet" href="css/glass-interface.css">
</head>
<body>
  <!-- Synthwave Background -->

  <!-- Hexagonal Socket Animation -->
  <div class="socket">
    <div class="gel center-gel">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c1 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c2 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c3 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c4 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c5 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c6 r1">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c7 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c8 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c9 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c10 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c11 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c12 r2">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c13 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c14 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c15 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c16 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c17 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>

    <div class="gel c18 r3">
      <div class="hex-brick h1"></div>
      <div class="hex-brick h2"></div>
      <div class="hex-brick h3"></div>
    </div>
  </div>

  <!-- Radio Player Window -->
  <div class="glass-window radio-player" id="radio-window">
    <div class="window-header">
      <div class="window-title">FAIT Radio</div>
      <div class="window-controls">
        <button class="control-btn close" onclick="toggleWindow('radio-window')"></button>
        <button class="control-btn minimize"></button>
        <button class="control-btn maximize"></button>
      </div>
    </div>
    <div class="window-content">
      <div class="station-display">
        <div class="station-name" id="station-name">FAIT FM</div>
        <div class="station-description" id="station-description">Select a station to start listening</div>
        <div class="status-bar" id="status-bar">Ready</div>
      </div>
      
      <div class="player-controls">
        <button class="play-button" id="play-btn">
          <span id="play-icon">‚ñ∂</span>
        </button>
        
        <div class="volume-control">
          <div class="volume-label">Volume</div>
          <input type="range" class="volume-slider" id="volume-slider" 
                 min="0" max="100" value="50">
        </div>
      </div>
    </div>
  </div>

  <!-- Station Selector Window -->
  <div class="glass-window station-selector" id="stations-window">
    <div class="window-header">
      <div class="window-title">Stations</div>
      <div class="window-controls">
        <button class="control-btn close" onclick="toggleWindow('stations-window')"></button>
        <button class="control-btn minimize"></button>
        <button class="control-btn maximize"></button>
      </div>
    </div>
    <div class="window-content">
      <div class="station-list" id="station-list">
        <!-- Station items will be generated here -->
      </div>
    </div>
  </div>

  <!-- Station Creator Window -->
  <div class="glass-window station-creator" id="creator-window" style="display: none;">
    <div class="window-header">
      <div class="window-title">‚ú® Create New Station</div>
      <div class="window-controls">
        <button class="control-btn close" onclick="toggleWindow('creator-window')"></button>
        <button class="control-btn minimize"></button>
        <button class="control-btn maximize"></button>
      </div>
    </div>
    <div class="window-content">
      <div class="form-group">
        <label for="station-name-input">üéµ Station Name</label>
        <input type="text" id="station-name-input" placeholder="e.g., Synthwave FM" maxlength="50">
        <small>Give your station a catchy name</small>
      </div>

      <div class="form-group">
        <label for="station-description-input">üìù Description</label>
        <input type="text" id="station-description-input" placeholder="e.g., The best synthwave tracks for late night coding" maxlength="100">
        <small>Describe what makes this station special</small>
      </div>

      <div class="form-group">
        <label for="station-youtube-input">üé¨ YouTube Content</label>
        <input type="text" id="station-youtube-input" placeholder="Video ID, Playlist ID, or full YouTube URL">
        <small>
          <strong>Supported formats:</strong><br>
          ‚Ä¢ Video ID: <code>dQw4w9WgXcQ</code><br>
          ‚Ä¢ Playlist ID: <code>PLrAl6rYAS4Z7hWOgOgKjKW8VaOtMnKGWz</code><br>
          ‚Ä¢ Full URL: <code>https://youtube.com/watch?v=VIDEO_ID</code>
        </small>
      </div>

      <div class="form-group">
        <label for="station-color-input">üé® Theme Color</label>
        <input type="color" id="station-color-input" value="#FF1493">
        <small>Choose a color that represents your station's vibe</small>
      </div>

      <div class="button-group">
        <button class="btn primary" id="save-station-btn">üíæ Save Station</button>
        <button class="btn success" id="test-embed-btn">üß™ Test Embed</button>
        <button class="btn secondary" id="clear-form-btn">üóëÔ∏è Clear Form</button>
      </div>

      <div class="test-results" id="test-results">
        <h4>üîç Test Results</h4>
        <div id="test-output"></div>
      </div>
    </div>
  </div>

  <!-- Add Station Button -->
  <button class="add-station-btn" id="add-station-btn" onclick="toggleWindow('creator-window')">
    ‚ûï Add Station
  </button>

  <!-- Hidden YouTube container -->
  <div id="youtube-container" style="position: absolute; top: -1000px; left: -1000px;"></div>

  <!-- Load scripts -->
  <script src="js/stations.js"></script>
  <script src="js/youtube-player.js"></script>

  <script>
    class GlassRadio {
      constructor() {
        this.youtubePlayer = null;
        this.currentStation = null;
        this.isPlaying = false;
        this.volume = 50;
        this.currentStationIndex = 0;
        this.stations = [];
        
        this.init();
      }

      async init() {
        console.log('üéµ Initializing Glass Radio Interface...');
        
        // Initialize YouTube player
        this.youtubePlayer = new YouTubePlayer();
        
        // Load stations
        this.loadStations();
        
        // Generate station list
        this.generateStationList();
        
        // Setup event listeners
        this.setupEventListeners();
        
        // Setup YouTube events
        this.setupYouTubeEvents();
        
        // Load default station
        this.loadDefaultStation();
        
        // Make windows draggable
        this.makeDraggable();
        
        console.log('‚úÖ Glass Radio initialized');
      }

      loadStations() {
        const savedStations = localStorage.getItem('radioStations');
        if (savedStations) {
          try {
            this.stations = JSON.parse(savedStations);
          } catch (error) {
            this.stations = [...window.stationData];
          }
        } else {
          this.stations = [...window.stationData];
        }
        window.stationData = this.stations;
      }

      generateStationList() {
        const container = document.getElementById('station-list');
        container.innerHTML = '';

        this.stations.forEach((station, index) => {
          const item = document.createElement('div');
          item.className = 'station-item';
          item.innerHTML = `
            <h3>${station.name}</h3>
            <p>${station.description}</p>
          `;
          
          item.addEventListener('click', () => {
            this.selectStation(index);
          });
          
          container.appendChild(item);
        });
      }

      setupEventListeners() {
        // Play button
        document.getElementById('play-btn').addEventListener('click', () => {
          this.togglePlayback();
        });

        // Volume slider
        document.getElementById('volume-slider').addEventListener('input', (e) => {
          this.setVolume(parseInt(e.target.value));
        });

        // Admin form
        document.getElementById('save-station-btn').addEventListener('click', () => {
          this.saveStation();
        });

        document.getElementById('test-embed-btn').addEventListener('click', () => {
          this.testEmbedding();
        });

        document.getElementById('clear-form-btn').addEventListener('click', () => {
          this.clearForm();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
          switch(e.key) {
            case ' ':
              e.preventDefault();
              this.togglePlayback();
              break;
            case 'ArrowUp':
              e.preventDefault();
              this.nextStation();
              break;
            case 'ArrowDown':
              e.preventDefault();
              this.previousStation();
              break;
            case 'a':
              if (e.ctrlKey || e.metaKey) {
                e.preventDefault();
                toggleWindow('admin-window');
              }
              break;
          }
        });
      }

      setupYouTubeEvents() {
        this.youtubePlayer.addEventListener('ready', () => {
          console.log('üéµ YouTube player ready');
          this.updateStatus('Ready');
        });

        this.youtubePlayer.addEventListener('stationLoaded', (event) => {
          console.log('üìª Station loaded:', event.station?.name);
          this.updateStatus('Loaded');
        });

        this.youtubePlayer.addEventListener('play', () => {
          console.log('‚ñ∂Ô∏è Playback started');
          this.isPlaying = true;
          this.updatePlayButton();
          this.updateStatus('Playing');
        });

        this.youtubePlayer.addEventListener('pause', () => {
          console.log('‚è∏Ô∏è Playback paused');
          this.isPlaying = false;
          this.updatePlayButton();
          this.updateStatus('Paused');
        });

        this.youtubePlayer.addEventListener('error', (event) => {
          console.error('‚ùå YouTube error:', event);
          this.updateStatus('Error - Trying next station');
          setTimeout(() => this.nextStation(), 2000);
        });
      }

      selectStation(index) {
        if (index >= this.stations.length) return;
        
        const station = this.stations[index];
        this.currentStation = station;
        this.currentStationIndex = index;
        
        // Update UI
        this.updateStationDisplay(station);
        this.updateStationList(index);
        this.updateStatus('Loading...');
        
        // Load in YouTube player
        if (this.youtubePlayer && this.youtubePlayer.isReady) {
          this.youtubePlayer.loadStation(station);
        } else {
          // Wait for YouTube player to be ready
          this.youtubePlayer.addEventListener('ready', () => {
            this.youtubePlayer.loadStation(station);
          });
        }
      }

      togglePlayback() {
        if (!this.currentStation) {
          this.updateStatus('Select a station first');
          return;
        }

        if (this.isPlaying) {
          this.youtubePlayer.pause();
        } else {
          this.youtubePlayer.play();
        }
      }

      nextStation() {
        const nextIndex = (this.currentStationIndex + 1) % this.stations.length;
        this.selectStation(nextIndex);
      }

      previousStation() {
        const prevIndex = this.currentStationIndex === 0 ? 
          this.stations.length - 1 : this.currentStationIndex - 1;
        this.selectStation(prevIndex);
      }

      setVolume(volume) {
        this.volume = volume;
        if (this.youtubePlayer) {
          this.youtubePlayer.setVolume(volume);
        }
      }

      updateStationDisplay(station) {
        document.getElementById('station-name').textContent = station.name;
        document.getElementById('station-description').textContent = station.description;
      }

      updateStationList(activeIndex) {
        const items = document.querySelectorAll('.station-item');
        items.forEach((item, index) => {
          item.classList.toggle('active', index === activeIndex);
        });
      }

      updatePlayButton() {
        const playBtn = document.getElementById('play-btn');
        const playIcon = document.getElementById('play-icon');
        
        if (this.isPlaying) {
          playBtn.classList.add('playing');
          playIcon.textContent = '‚è∏';
        } else {
          playBtn.classList.remove('playing');
          playIcon.textContent = '‚ñ∂';
        }
      }

      updateStatus(status) {
        document.getElementById('status-bar').textContent = status;
      }

      loadDefaultStation() {
        if (this.stations.length > 0) {
          this.selectStation(0);
        }
      }

      // Admin functions
      saveStation() {
        const name = document.getElementById('station-name-input').value.trim();
        const description = document.getElementById('station-description-input').value.trim();
        const youtubeId = document.getElementById('station-youtube-input').value.trim();
        const color = document.getElementById('station-color-input').value;

        if (!name || !youtubeId) {
          this.showTestResult('Name and YouTube content are required', 'error');
          return;
        }

        const station = {
          id: 'station-' + Date.now(),
          name: name,
          description: description || 'No description',
          youtubeId: this.extractYouTubeId(youtubeId),
          color: color
        };

        this.stations.push(station);
        localStorage.setItem('radioStations', JSON.stringify(this.stations));
        this.generateStationList();
        this.clearForm();
        this.showTestResult('‚úÖ Station saved successfully!', 'success');
      }

      testEmbedding() {
        const youtubeInput = document.getElementById('station-youtube-input').value.trim();

        if (!youtubeInput) {
          this.showTestResult('Please enter YouTube content before testing', 'error');
          return;
        }

        const youtubeId = this.extractYouTubeId(youtubeInput);
        if (!youtubeId) {
          this.showTestResult('‚ùå Invalid YouTube URL or ID format', 'error');
          return;
        }

        this.showTestResult('üîç Testing embedding...', 'info');

        // Load YouTube API if not already loaded
        if (!window.YT) {
          this.showTestResult('‚è≥ Loading YouTube API...', 'info');
          const tag = document.createElement('script');
          tag.src = 'https://www.youtube.com/iframe_api';
          const firstScriptTag = document.getElementsByTagName('script')[0];
          firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

          window.onYouTubeIframeAPIReady = () => {
            this.testEmbedding();
          };
          return;
        }

        // Create test player
        const testId = `test-player-${Date.now()}`;
        const testDiv = document.createElement('div');
        testDiv.id = testId;
        document.getElementById('youtube-container').appendChild(testDiv);

        let hasResponded = false;
        const timeout = setTimeout(() => {
          if (!hasResponded) {
            hasResponded = true;
            this.showTestResult('‚è∞ Test timeout - content may not be available', 'warning');
            cleanup();
          }
        }, 15000);

        const cleanup = () => {
          clearTimeout(timeout);
          if (testDiv.parentNode) {
            testDiv.parentNode.removeChild(testDiv);
          }
        };

        try {
          new YT.Player(testId, {
            height: '1',
            width: '1',
            videoId: youtubeId,
            playerVars: {
              autoplay: 0,
              controls: 0
            },
            events: {
              onReady: () => {
                if (!hasResponded) {
                  hasResponded = true;
                  this.showTestResult('‚úÖ Embedding test PASSED! This content can be embedded.', 'success');
                  this.showTestResult('üí° You can safely save this station - it will work in the radio.', 'info');
                  cleanup();
                }
              },
              onError: (event) => {
                if (!hasResponded) {
                  hasResponded = true;
                  let errorMessage = 'Unknown error';
                  let suggestion = '';

                  switch (event.data) {
                    case 2:
                      errorMessage = 'Invalid video/playlist ID';
                      suggestion = 'Check that the ID is correct.';
                      break;
                    case 5:
                      errorMessage = 'HTML5 player error';
                      suggestion = 'Try different content - this may have technical issues.';
                      break;
                    case 100:
                      errorMessage = 'Content not found or private';
                      suggestion = 'Make sure the content is public and the ID is correct.';
                      break;
                    case 101:
                    case 150:
                      errorMessage = 'Content owner does not allow embedding';
                      suggestion = 'Find different content that allows embedding.';
                      break;
                    default:
                      errorMessage = `Error code: ${event.data}`;
                      suggestion = 'Try different content.';
                  }

                  this.showTestResult(`‚ùå Embedding test FAILED: ${errorMessage}`, 'error');
                  this.showTestResult(`üí° Suggestion: ${suggestion}`, 'warning');
                  cleanup();
                }
              }
            }
          });
        } catch (error) {
          if (!hasResponded) {
            hasResponded = true;
            this.showTestResult(`‚ùå Test failed: ${error.message}`, 'error');
            cleanup();
          }
        }
      }

      extractYouTubeId(input) {
        if (input.length === 11 && !input.includes('/')) return input;
        
        try {
          const url = new URL(input);
          const params = new URLSearchParams(url.search);
          return params.get('v') || params.get('list') || input;
        } catch {
          return input;
        }
      }

      clearForm() {
        document.getElementById('station-name-input').value = '';
        document.getElementById('station-description-input').value = '';
        document.getElementById('station-youtube-input').value = '';
        document.getElementById('station-color-input').value = '#007AFF';
        this.clearTestResults();
      }

      showTestResult(message, type) {
        const results = document.getElementById('test-results');
        const output = document.getElementById('test-output');
        
        results.classList.add('show');
        
        const result = document.createElement('div');
        result.className = `test-result ${type}`;
        result.textContent = message;
        
        output.appendChild(result);
        output.scrollTop = output.scrollHeight;
      }

      clearTestResults() {
        const results = document.getElementById('test-results');
        const output = document.getElementById('test-output');
        
        results.classList.remove('show');
        output.innerHTML = '';
      }

      makeDraggable() {
        const windows = document.querySelectorAll('.glass-window');
        windows.forEach(window => {
          const header = window.querySelector('.window-header');
          let isDragging = false;
          let currentX, currentY, initialX, initialY;

          header.addEventListener('mousedown', (e) => {
            isDragging = true;
            initialX = e.clientX - window.offsetLeft;
            initialY = e.clientY - window.offsetTop;
          });

          document.addEventListener('mousemove', (e) => {
            if (isDragging) {
              currentX = e.clientX - initialX;
              currentY = e.clientY - initialY;
              window.style.left = currentX + 'px';
              window.style.top = currentY + 'px';
            }
          });

          document.addEventListener('mouseup', () => {
            isDragging = false;
          });
        });
      }
    }

    // Window management
    function toggleWindow(windowId) {
      const window = document.getElementById(windowId);
      if (window.style.display === 'none') {
        window.style.display = 'block';
      } else {
        window.style.display = 'none';
      }
    }

    // Initialize
    let glassRadio;
    window.addEventListener('load', () => {
      glassRadio = new GlassRadio();
    });
  </script>
</body>
</html>
